---
import { CardExperience } from '@/shared/components/Cards/Cards'
import { getCollection, render } from 'astro:content'
import ProfileSection from '@/layouts/ProfileSection.astro'
import { DownloadPdf } from '@/shared/components/DownloadPdf/DownloadPdf'
import normalizeTech from '@/shared/utils/utils'
import ArrowCard from '../shared/ArrowCard.astro'

const experiences = await getCollection('experience')
---

<ProfileSection id="experience" heading="Experiencia">
  <div class="grid w-5/6 grid-cols-1 gap-1">
    {
      await Promise.all(
        experiences.map(async (exp) => {
          const { data } = exp
          const { position, company, employment_type, start_date, end_date, tech, id } = data

          const finishDate = end_date ?? 'now'

          const { Content } = await render(exp)

          return (
            <CardExperience
              company={`${company} Â· ${employment_type}`}
              startDate={start_date}
              finishDate={finishDate}
              skills={normalizeTech(tech)}
              pageId={id}
              position={position}
              client:load
            >
              <Content />
            </CardExperience>
            <ArrowCard class="w-15 h-15 mb-8 mt-8" />
          )
        }),
      )
    }
    <DownloadPdf />
  </div>
</ProfileSection>
